#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Tue May 11 21:27:47 2021

@author: jaredmiller
"""

file = open("log.txt", "r")

lines = file.readlines()
nameCount = 0
modify = 0
deletedCount = 0
createdFile = []   

malware = False          
for i in lines:
    file_action = i.split(":")[0] 
    file_path = i.split(":")[1].strip()
    file_path_separated = file_path.split("\\")  
    

    if file_action =='File Rename':
        if len(file_path_separated)>=2:
            file_name = file_path_separated[1].split('->')[0].strip()
           
            if file_name.endswith('.docx'):
                nameCount = nameCount + 1

    if file_action =='File Modify':
        if len(file_path_separated)>=2:
            modify=modify+1

    if file_action =='File Create':
        createdFile.append(file_path)
    if file_action =='File Delete':
        if file_path in createdFile:
            deletedCount = deletedCount+1

print(f'The number of docx in ScapeGoat folder that has been renamed is {nameCount}')
print(f'The number of files in the ScapeGoat folder that was modified is {modify}')
print(f'The number of self deletes is {deletedCount}')

if nameCount > 3 and modify > 3 and deletedCount >= 1:
    malware = True

if malware == True:
    print('malware detected --> HEUR:Trojan-Ransom.DocxEncrypt.Generic')
else:
    print('No malware found')
